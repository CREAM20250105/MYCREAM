<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CREAMブログ| CREAM</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 2em;
      background-color: #f4f4f4;
    }
    h1 {
      color: #fbbd08;
      text-align: center;
    }
    form, .blog-preview, .blog-list {
      max-width: 600px;
      margin: 2em auto;
      background: white;
      padding: 1em;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, textarea {
      width: 100%;
      padding: 0.8em;
      margin-bottom: 1em;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      padding: 0.8em 1.2em;
      background-color: #fbbd08;
      border: none;
      color: black;
      border-radius: 4px;
      cursor: pointer;
    }
    .blog-preview img {
      max-width: 100%;
      border-radius: 6px;
      margin-bottom: 1em;
    }
    .blog-item {
      margin-bottom: 1.5em;
      padding: 1em;
      background: #fff;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .blog-item h3 {
      margin: 0.5em 0;
    }
    .blog-item button {
      margin-right: 0.5em;
    }
    #searchInput {
      width: 100%;
      padding: 0.5em;
      margin-bottom: 1em;
    }
  </style>
</head>
<body>
  <h1>ブログ投稿フォーム</h1>
  <form id="blogForm">
    <input type="text" id="title" placeholder="タイトル" required>
    <textarea id="content" rows="5" placeholder="本文" required></textarea>
    <input type="file" id="imageInput" accept="image/*">
    <input type="password" id="password" placeholder="投稿パスワード" required>
    <button type="submit">投稿</button>
  </form>

  <div class="blog-preview" id="preview" style="display:none">
    <h2>プレビュー</h2>
    <h3 id="previewTitle"></h3>
    <img id="previewImage">
    <p id="previewContent"></p>
  </div>

  <div class="blog-list">
    <h2>投稿一覧</h2>
    <input type="text" id="searchInput" placeholder="検索キーワード">
    <div id="posts"></div>
  </div>

  <script>
    const form = document.getElementById('blogForm');
    const preview = document.getElementById('preview');
    const postsEl = document.getElementById('posts');
    const storageKey = 'blogPosts';
    let posts = JSON.parse(localStorage.getItem(storageKey) || '[]');

    function updatePreview() {
      document.getElementById('previewTitle').innerText = document.getElementById('title').value;
      document.getElementById('previewContent').innerText = document.getElementById('content').value;
      const file = document.getElementById('imageInput').files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => {
          document.getElementById('previewImage').src = e.target.result;
          preview.style.display = 'block';
        }
        reader.readAsDataURL(file);
      } else {
        preview.style.display = 'none';
      }
    }

    form.addEventListener('input', updatePreview);

    form.addEventListener('submit', e => {
      e.preventDefault();
      if (document.getElementById('password').value !== 'n19900521') {
        alert('パスワードが間違っています');
        return;
      }
      const title = document.getElementById('title').value;
      const content = document.getElementById('content').value;
      const file = document.getElementById('imageInput').files[0];
      const reader = new FileReader();
      reader.onload = e => {
        const image = e.target.result;
        const newPost = { title, content, image, time: new Date().toLocaleString() };
        posts.unshift(newPost);
        localStorage.setItem(storageKey, JSON.stringify(posts));
        renderPosts();
        form.reset();
        preview.style.display = 'none';
      };
      if (file) reader.readAsDataURL(file);
      else {
        const newPost = { title, content, image: '', time: new Date().toLocaleString() };
        posts.unshift(newPost);
        localStorage.setItem(storageKey, JSON.stringify(posts));
        renderPosts();
        form.reset();
        preview.style.display = 'none';
      }
    });

    function renderPosts() {
      postsEl.innerHTML = '';
      const keyword = document.getElementById('searchInput').value.toLowerCase();
      posts.filter(p => p.title.toLowerCase().includes(keyword) || p.content.toLowerCase().includes(keyword))
        .forEach((post, index) => {
          const div = document.createElement('div');
          div.className = 'blog-item';
          div.innerHTML = `
            <small>${post.time}</small>
            <h3>${post.title}</h3>
            ${post.image ? `<img src="${post.image}" style="max-width:100%; border-radius:6px;">` : ''}
            <p>${post.content}</p>
            <button onclick="editPost(${index})">編集</button>
            <button onclick="deletePost(${index})">削除</button>
          `;
          postsEl.appendChild(div);
        });
    }

    function deletePost(index) {
      if (!confirm('削除しますか？')) return;
      posts.splice(index, 1);
      localStorage.setItem(storageKey, JSON.stringify(posts));
      renderPosts();
    }

    function editPost(index) {
      const post = posts[index];
      const newTitle = prompt('新しいタイトル', post.title);
      const newContent = prompt('新しい内容', post.content);
      if (newTitle && newContent) {
        post.title = newTitle;
        post.content = newContent;
        localStorage.setItem(storageKey, JSON.stringify(posts));
        renderPosts();
      }
    }

    document.getElementById('searchInput').addEventListener('input', renderPosts);

    window.onload = renderPosts;
  </script>
</body>
</html>
